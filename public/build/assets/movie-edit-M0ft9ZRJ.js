import{r as m,m as M,j as e,L as R,S as v}from"./app-C2weOUhd.js";import{I as p}from"./input-error-6B614YZa.js";import{I as N}from"./input-field-BgY6ZdIY.js";import{A as T}from"./app-layout-moFQN0ro.js";import{S as k}from"./slimselect-BwEOPyc-.js";import{L as I}from"./loader-circle-D561zkUL.js";import"./clsx-B-dksMZM.js";const J=({categories:y,movie:r})=>{var j;const h=m.useRef(null),[S,w]=m.useState([]),[_,f]=m.useState(r.banner),[u,o]=m.useState(!1),[V,B]=m.useState(0),[x,E]=m.useState(r.episodes),{data:t,setData:l,post:C,errors:d,progress:g}=M({title:r.title,description:r.description,featured:r.featured,premium:r.premium,episode_no:r.episodes_count,existing_banner:r.banner_path,banner:null,categories:r.categories.map(s=>s.id),episodes:((j=r.episodes)==null?void 0:j.map(s=>({id:s.id,video:null,is_premium:s.is_premium,existing_video:s.video_path,active:s.active})))||Array(r.episode_count).fill(null).map(()=>({id:Date.now().toString()+Math.random().toString(36).substr(2,9),video:null,is_premium:!1}))});m.useEffect(()=>{const s=t.episode_no,i=t.episodes.length;if(s>i){const a=s-i,n=Array(a).fill(null).map(()=>({id:Date.now().toString()+Math.random().toString(36).substr(2,9),video:null,is_premium:!1}));l("episodes",[...t.episodes,...n])}else s<i&&l("episodes",t.episodes.slice(0,s))},[t.episode_no]);const D=s=>i=>{if(i.target.files&&i.target.files[0]){const a=i.target.files[0];l(s,a);{const n=new FileReader;n.onload=c=>{var b;(b=c.target)!=null&&b.result&&f(c.target.result)},n.readAsDataURL(a)}}},F=(s,i)=>{if(i.target.files&&i.target.files[0]){const a=i.target.files[0];if(!["video/mp4","video/x-m4v","video/quicktime"].includes(a.type)){alert("Only MP4, M4V, and QuickTime videos are allowed"),i.target.value="";return}l("episodes",t.episodes.map(c=>c.id===s?{...c,video:a}:c));const n=URL.createObjectURL(a);E(c=>({...c,[s.toString()]:n}))}},P=(s,i)=>{l("episodes",t.episodes.map(a=>a.id===s?{...a,is_premium:i}:a))},$=async s=>{s.preventDefault(),o(!0);const i=new FormData;i.append("title",t.title),i.append("description",t.description),i.append("featured",t.featured?"1":"0"),i.append("premium",t.premium?"1":"0"),i.append("episode_no",t.episode_no.toString()),t.banner?i.append("banner",t.banner):r.banner_path&&i.append("existing_banner",r.banner_path),t.categories.forEach(a=>i.append("categories[]",a.toString())),t.episodes.forEach((a,n)=>{a.video?i.append(`episodes[${n}][video]`,a.video):a.existing_video&&i.append(`episodes[${n}][existing_video]`,a.existing_video),i.append(`episodes[${n}][id]`,a.id.toString()),i.append(`episodes[${n}][is_premium]`,a.is_premium?"1":"0")});try{await C(route("system.movie.update",r.id),{onSuccess:()=>{o(!1)},onError:a=>{o(!1),console.error("Update errors:",a)}})}catch(a){o(!1),console.error("Update error:",a)}},U=async(s,i)=>{if(confirm("Are you sure you want to delete this episode?")){o(!0);try{typeof s=="number"&&await v.delete(route("system.movie.episode.destroy",s)),l("episodes",t.episodes.filter((a,n)=>n!==i)),l("episode_no",t.episode_no-1)}catch(a){console.error("Failed to delete episode:",a)}finally{o(!1)}}},A=async s=>{o(!0);try{await v.put(route("system.movie.episode.status",s.id)),l("episodes",t.episodes.map(i=>i.id===s.id?{...i,active:!i.active}:i))}catch(i){console.error(`Failed to ${s.active?"disable":"enable"} episode:`,i)}finally{o(!1)}},L=async()=>{if(confirm("Are you sure you want to delete this poster?")){o(!0);try{await v.put(route("system.movie.banner.delete",r.id),{},{onSuccess:()=>{f(null),l("banner",null)}})}catch(s){console.error("Failed to remove banner:",s)}finally{o(!1)}}};return m.useEffect(()=>{if(h.current){const s=new k({select:h.current,settings:{showSearch:!0,placeholderText:"Select Categories",closeOnSelect:!1},events:{afterChange:i=>{const a=i.map(n=>parseInt(n.value));w(a),l("categories",a)}}});return()=>{s.destroy()}}},[S]),e.jsxs(e.Fragment,{children:[e.jsx(R,{title:"Mini Series"}),e.jsx(T,{title:"Mini Series",mainTitle:!0,children:e.jsx("div",{className:"col-12",children:e.jsx("form",{onSubmit:$,className:"sign__form sign__form--add",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 col-xl-6",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsx(N,{name:"title",value:t.title,onChange:(s,i)=>l(s,i),placeholder:"Title",error:d.title,required:!0}),e.jsx(p,{message:d.title})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsx("textarea",{className:`sign__textarea ${d.description?"is-invalid":""}`,placeholder:"Description",onChange:s=>l("description",s.target.value),value:t.description}),e.jsx(p,{message:d.description})]})}),_&&e.jsxs("div",{className:"col-12 mb-3",children:[e.jsx("div",{className:"mt-2 mb-3",children:e.jsx("img",{src:_,alt:"Banner preview",className:"img-thumbnail",style:{maxWidth:"200px",maxHeight:"200px"}})}),e.jsx("button",{type:"button",className:"btn btn-danger btn-sm",onClick:()=>L(),disabled:u,children:"Remove Poster"})]})]})}),e.jsx("div",{className:"col-12 col-xl-6",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsxs("div",{className:"sign__gallery",children:[e.jsx("label",{htmlFor:"sign__gallery-upload",children:"Upload Poster"}),e.jsx("input",{id:"sign__gallery-upload",name:"banner",className:"sign__gallery-upload",type:"file",accept:".png, .jpg, .jpeg",onChange:D("banner")})]}),e.jsx(p,{message:d.banner})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsx("label",{className:"sign__label",children:"No. of Episode:"}),e.jsx(N,{type:"number",name:"episode_no",value:t.episode_no,onChange:(s,i)=>{const a=parseInt(i);isNaN(a)||l(s,Math.max(1,a))},placeholder:"No. of Episode",error:d.episode_no}),e.jsx(p,{message:d.episode_no})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsx("select",{className:"sign__selectjs",id:"sign__genre",ref:h,onChange:s=>l("categories",s.target.value),multiple:!0,children:y.data.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))}),e.jsx(p,{message:d.categories})]})})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__episodes mt-4",children:[e.jsx("h4",{className:"sign__title",children:"Episodes"}),t.episodes.map((s,i)=>e.jsx("div",{className:"sign__episode mt-3",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"sign__episode-title",children:["Episode #",i+1]}),e.jsxs("div",{children:[e.jsxs("button",{type:"button",className:`btn btn-${s.active?"danger":"success"} btn-sm me-2`,onClick:()=>A(s),disabled:u,children:[s.active?"Disable":"Enable"," Episode #",i+1]}),e.jsxs("button",{type:"button",className:"btn btn-danger btn-sm",onClick:()=>U(s.id,i),disabled:u,children:["Delete Episode #",i+1]})]})]})}),e.jsx("div",{className:"col-12 col-md-8",children:e.jsxs("div",{className:"sign__video",children:[e.jsxs("label",{htmlFor:`episode-video-${s.id}`,children:["Upload episode ",i+1]}),e.jsx("input",{id:`episode-video-${s.id}`,type:"file",accept:"video/mp4,video/x-m4v,video/*",onChange:a=>F(s.id,a)})]})}),e.jsx("div",{className:"col-12 col-md-4",children:e.jsx("div",{className:"d-flex align-items-center gap-3",children:e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("select",{className:"form-select",value:s.is_premium?"1":"0",onChange:a=>P(s.id,a.target.value==="1"),children:[e.jsx("option",{value:"0",children:"Free"}),e.jsx("option",{value:"1",children:"Premium"})]}),e.jsx(p,{message:d[`episodes.${i}.is_premium`]})]})})}),x[s.id]&&e.jsx("video",{src:x[s.id],controls:!0,style:{maxWidth:"300px"}}),!x[s.id]&&s.existing_video&&e.jsx("video",{src:s.existing_video,controls:!0,style:{maxWidth:"300px"}})]})},s.id))]})}),e.jsxs("div",{className:"col-12 mt-4",children:[e.jsx("button",{type:"submit",className:"sign__btn sign__btn--small",disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"animate-spin mr-2"}),"Processing..."]}):e.jsx("span",{children:"Publish"})}),g&&e.jsxs("div",{className:"mt-4 text-white",children:[e.jsxs("p",{children:["Uploading: ",g.percentage,"%"]}),e.jsx("div",{className:"progress",children:e.jsxs("div",{className:"progress-bar bg-warning",role:"progressbar",style:{width:`${g.percentage}%`},"aria-valuemin":"0","aria-valuemax":"100",children:[g.percentage,"%"]})})]})]})]})})})})]})};export{J as default};
