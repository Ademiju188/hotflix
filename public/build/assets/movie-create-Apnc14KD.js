import{r as d,m as P,j as e,L as D}from"./app-iXmw2z_F.js";import{I as c}from"./input-error-JX4fCH7R.js";import{I as f}from"./input-field-Babt2Miw.js";import{A as L}from"./app-layout-CUYHb3U_.js";import{S as M}from"./slimselect-COPtFSi2.js";import{L as T}from"./loader-circle-CjzKTp_M.js";import"./clsx-B-dksMZM.js";const k=({categories:_})=>{const g=d.useRef(null),[$,N]=d.useState([]),[h,b]=d.useState(null),[x,m]=d.useState(!1),[o,v]=d.useState({}),[j,S]=d.useState({}),{data:a,setData:n,post:w,progress:u}=P({title:"",description:"",featured:!0,premium:!1,episode_number:1,banner:null,categories:[],episodes:Array(1).fill(null).map(()=>({id:Date.now().toString()+Math.random().toString(36).substr(2,9),video:null,is_premium:!1}))});d.useEffect(()=>{const s=a.episode_number,i=a.episodes.length;if(s>i){const r=s-i,t=Array(r).fill(null).map(()=>({id:Date.now().toString()+Math.random().toString(36).substr(2,9),video:null,is_premium:!1}));n("episodes",[...a.episodes,...t])}else s<i&&n("episodes",a.episodes.slice(0,s))},[a.episode_number]);const y=s=>i=>{if(i.target.files&&i.target.files[0]){const r=i.target.files[0];n(s,r);{const t=new FileReader;t.onload=l=>{var p;(p=l.target)!=null&&p.result&&b(l.target.result)},t.readAsDataURL(r)}}},E=(s,i)=>{if(i.target.files&&i.target.files[0]){const r=i.target.files[0];if(!["video/mp4","video/x-m4v","video/quicktime"].includes(r.type)){alert("Only MP4, M4V, and QuickTime videos are allowed"),i.target.value="";return}n("episodes",a.episodes.map(l=>l.id===s?{...l,video:r}:l));const t=URL.createObjectURL(r);S(l=>({...l,[s]:t}))}},C=(s,i)=>{n("episodes",a.episodes.map(r=>r.id===s?{...r,is_premium:i}:r))},F=async s=>{var r;s.preventDefault(),m(!0);const i={};if(a.title.trim()||(i.title="Title is required"),a.categories.length===0&&(i.categories="At least one category must be selected"),a.banner||(i.banner="Banner image is required"),a.episodes.forEach((t,l)=>{t.video||(i[`episodes.${l}.video`]="Episode video is required")}),Object.keys(i).length>0){v(i),m(!1);return}try{const t=new FormData;t.append("title",a.title),t.append("description",a.description),t.append("featured",a.featured?"1":"0"),t.append("premium",a.premium?"1":"0"),t.append("episode_number",((r=a.episode_number)==null?void 0:r.toString())||"1"),a.banner&&t.append("banner",a.banner),a.categories.forEach(l=>t.append("categories[]",l.toString())),a.episodes.forEach((l,p)=>{l.video&&(t.append(`episodes[${p}][video]`,l.video),t.append(`episodes[${p}][is_premium]`,l.is_premium?"1":"0"))}),await w(route("system.movie.store"),{formData:t,onSuccess:()=>{m(!1)},onError:l=>{m(!1),v(l),console.error("Submission errors:",l)}})}catch(t){m(!1),console.error("Submission error:",t)}};return d.useEffect(()=>{if(g.current){const s=new M({select:g.current,settings:{showSearch:!0,placeholderText:"Select Categories",closeOnSelect:!1},events:{afterChange:i=>{const r=i.map(t=>parseInt(t.value));N(r),n("categories",r)}}});return()=>{s.destroy()}}},[]),e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Mini Series"}),e.jsx(L,{title:"Mini Series",mainTitle:!0,children:e.jsx("div",{className:"col-12",children:e.jsx("form",{onSubmit:F,className:"sign__form sign__form--add",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 col-xl-6",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsx(f,{name:"title",value:a.title,onChange:(s,i)=>n(s,i),placeholder:"Title",error:o.title,required:!0}),e.jsx(c,{message:o.title})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsx("textarea",{className:`sign__textarea ${o.description?"is-invalid":""}`,placeholder:"Description",onChange:s=>n("description",s.target.value),value:a.description}),e.jsx(c,{message:o.description})]})}),h&&e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"mt-2 mb-3",children:e.jsx("img",{src:h,alt:"Banner preview",className:"img-thumbnail",style:{maxWidth:"200px",maxHeight:"200px"}})})})]})}),e.jsx("div",{className:"col-12 col-xl-6",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsxs("div",{className:"sign__gallery",children:[e.jsx("label",{htmlFor:"sign__gallery-upload",children:"Upload Poster"}),e.jsx("input",{id:"sign__gallery-upload",name:"banner",className:"sign__gallery-upload",type:"file",accept:".png, .jpg, .jpeg",onChange:y("banner"),required:!0})]}),e.jsx(c,{message:o.banner})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsx("label",{className:"sign__label",children:"No. of Episode:"}),e.jsx(f,{type:"number",name:"episode_number",value:a.episode_number,onChange:(s,i)=>{if(i==="")n(s,i);else{const r=parseInt(i);isNaN(r)||n(s,Math.max(1,r))}},placeholder:"No. of Episode"}),e.jsx(c,{message:o.episode_number})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsx("select",{className:"sign__selectjs",id:"sign__genre",ref:g,multiple:!0,children:_.data.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))}),e.jsx(c,{message:o.categories})]})})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__episodes mt-4",children:[e.jsx("h4",{className:"sign__title",children:"Episodes"}),a.episodes.map((s,i)=>e.jsx("div",{className:"sign__episode mt-3",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12",children:e.jsxs("span",{className:"sign__episode-title",children:["Episode #",i+1]})}),e.jsx("div",{className:"col-12 col-md-8",children:e.jsxs("div",{className:"sign__video",children:[e.jsxs("label",{htmlFor:`episode-video-${s.id}`,children:["Upload episode ",i+1]}),e.jsx("input",{id:`episode-video-${s.id}`,type:"file",accept:"video/mp4,video/x-m4v,video/*",onChange:r=>E(s.id,r),required:!0})]})}),e.jsx("div",{className:"col-12 col-md-4",children:e.jsxs("div",{className:"sign__group",children:[e.jsxs("select",{className:"form-select",value:s.is_premium?"1":"0",onChange:r=>C(s.id,r.target.value==="1"),children:[e.jsx("option",{value:"0",children:"Free"}),e.jsx("option",{value:"1",children:"Premium"})]}),e.jsx(c,{message:o[`episodes.${i}.is_premium`]})]})}),j[s.id]&&e.jsx("video",{src:j[s.id],controls:!0,style:{maxWidth:"300px"}})]})},s.id))]})}),e.jsxs("div",{className:"col-12 mt-4",children:[e.jsx("button",{type:"submit",className:"sign__btn sign__btn--small",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"animate-spin mr-2"}),"Processing..."]}):e.jsx("span",{children:"Publish"})}),u&&e.jsxs("div",{className:"mt-4 text-white",children:[e.jsxs("p",{children:["Uploading: ",u.percentage,"%"]}),e.jsx("div",{className:"progress",children:e.jsxs("div",{className:"progress-bar bg-warning",role:"progressbar",style:{width:`${u.percentage}%`},"aria-valuemin":"0","aria-valuemax":"100",children:[u.percentage,"%"]})})]})]})]})})})})]})};export{k as default};
