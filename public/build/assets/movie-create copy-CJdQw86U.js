import{r as o,m as U,j as e,L as A}from"./app-C2weOUhd.js";import{I as p}from"./input-error-6B614YZa.js";import{I as S}from"./input-field-BgY6ZdIY.js";import{A as M}from"./app-layout-moFQN0ro.js";import{S as f}from"./slimselect-BwEOPyc-.js";import{L as O}from"./loader-circle-D561zkUL.js";import"./clsx-B-dksMZM.js";const ee=({categories:C,existingTags:I})=>{const j=o.useRef(null),_=o.useRef(null),w=o.useRef({}),m=o.useRef({}),[c,u]=o.useState([]),[z,E]=o.useState([]),[B,G]=o.useState([]),[H,J]=o.useState(""),{data:a,setData:g,post:F,processing:N,errors:d}=U({title:"",description:"",content_type:"single",featured:1,premium:1,duration:"",banner:null,video:null,categories:[],tags:[]});o.useEffect(()=>{if(_.current&&new f({select:_.current,settings:{showSearch:!1,placeholderText:"Select Package"}}),j.current){const s=new f({select:j.current,settings:{showSearch:!0,placeholderText:"Select Categories",closeOnSelect:!1},events:{afterChange:i=>{const t=i.map(l=>parseInt(l.value));E(t),g("categories",t)}}});return()=>{s.destroy()}}},[]),o.useEffect(()=>(Object.keys(m.current).forEach(s=>{var i;m.current[s]&&((i=m.current[s])==null||i.destroy(),m.current[s]=null)}),c.forEach(s=>{s.episodes.forEach(i=>{var r;const t=`${s.id}-${i.id}`,l=w.current[t];l&&(m.current[t]=new f({select:l,settings:{showSearch:!1,placeholderText:"Select Package"},events:{afterChange:n=>{if(n&&n.length>0){const h=n[0].value==="1";b(s.id,i.id,h)}}}}),(r=m.current[t])==null||r.setSelected(i.is_premium?"1":"0"))})}),()=>{Object.keys(m.current).forEach(s=>{var i;m.current[s]&&((i=m.current[s])==null||i.destroy())})}),[c]);const y=s=>i=>{if(i.target.files&&i.target.files[0]){const t=i.target.files[0];g(s,t);const l=new FileReader;l.onload=r=>{var n;(n=r.target)!=null&&n.result},l.readAsDataURL(t)}},$=(s,i)=>{if(i.target.files&&i.target.files[0]){const t=i.target.files[0],l=new FileReader;l.onload=r=>{var n;(n=r.target)!=null&&n.result&&u(c.map(h=>h.id===s?{...h,poster:t}:h))},l.readAsDataURL(t)}},D=(s,i,t)=>{if(t.target.files&&t.target.files[0]){const l=t.target.files[0],r=new FileReader;r.onload=n=>{var h;(h=n.target)!=null&&h.result&&u(c.map(x=>x.id===s?{...x,episodes:x.episodes.map(v=>v.id===i?{...v,video:l}:v)}:x))},r.readAsDataURL(l)}},R=()=>{const s={id:Date.now().toString(),title:"",poster:null,episodes:[{id:Date.now().toString(),video:null,is_premium:!0}]};u([...c,s])},k=s=>{u(c.filter(i=>i.id!==s))},P=s=>{u(c.map(i=>i.id===s?{...i,episodes:[...i.episodes,{id:Date.now().toString(),video:null,is_premium:!0}]}:i))},b=(s,i,t)=>{u(c.map(l=>l.id===s?{...l,episodes:l.episodes.map(r=>r.id===i?{...r,is_premium:t}:r)}:l))},T=(s,i)=>{u(c.map(t=>t.id===s?{...t,episodes:t.episodes.filter(l=>l.id!==i)}:t))},L=(s,i,t)=>{u(c.map(l=>l.id===s?{...l,[i]:t}:l))},q=s=>{s.preventDefault();const i=new FormData;i.append("title",a.title),i.append("description",a.description),i.append("content_type",a.content_type),i.append("featured",a.featured.toString()),i.append("premium",a.premium.toString()),i.append("duration",a.duration.toString()),a.banner&&i.append("banner",a.banner),a.video&&a.content_type==="single"&&i.append("video",a.video),a.categories.forEach(t=>i.append("categories[]",t.toString())),a.tags.forEach((t,l)=>{i.append(`tags[${l}][name]`,t.name),t.id&&i.append(`tags[${l}][id]`,t.id.toString())}),a.content_type==="series"&&c.forEach((t,l)=>{i.append(`seasons[${l}][title]`,t.title),t.poster&&i.append(`seasons[${l}][poster]`,t.poster),t.episodes.forEach((r,n)=>{r.video&&i.append(`seasons[${l}][episodes][${n}][video]`,r.video),i.append(`seasons[${l}][episodes][${n}][is_premium]`,r.is_premium?"1":"0")})}),console.log("FormData contents:");for(let[t,l]of i.entries())console.log(t,l);F(route("system.movie.store"),{formData:i,forceFormData:!0,onSuccess:()=>{},onError:t=>{console.error("Submission errors:",t)}})};return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"New Movie"}),e.jsx(M,{title:"New Movie",mainTitle:!0,children:e.jsx("div",{className:"col-12",children:e.jsx("form",{onSubmit:q,className:"sign__form sign__form--add",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 col-xl-7",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsx(S,{name:"title",value:a.title,onChange:(s,i)=>g(s,i),placeholder:"Title",error:d.title,required:!0}),e.jsx(p,{message:d.title})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsx("textarea",{className:`sign__textarea ${d.description?"is-invalid":""}`,placeholder:"Description",onChange:s=>g("description",s.target.value),value:a.description}),e.jsx(p,{message:d.description})]})}),e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"sign__group",children:[e.jsxs("div",{className:"sign__gallery",children:[e.jsx("label",{htmlFor:"sign__gallery-upload",children:"Upload cover (240x340)"}),e.jsx("input",{id:"sign__gallery-upload",name:"banner",className:"sign__gallery-upload",type:"file",accept:".png, .jpg, .jpeg",onChange:y("banner"),required:!0})]}),e.jsx(p,{message:d.banner})]})})]})}),e.jsx("div",{className:"col-12 col-xl-5",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsx("select",{className:"sign__selectjs",id:"sign__genre",ref:j,multiple:!0,children:C.data.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))}),e.jsx(p,{message:d.categories})]})}),e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"sign__group",children:[e.jsx(S,{type:"number",name:"duration",value:a.duration,onChange:(s,i)=>g(s,i),placeholder:"Movie Duration (minutes)",error:d.duration,required:!0}),e.jsx(p,{message:d.duration})]})}),e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"sign__group",children:[e.jsxs("select",{className:"sign__selectjs",id:"sign__genre",ref:_,onChange:s=>g("premium",s.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Premium"}),e.jsx("option",{value:"0",children:"Free"})]}),e.jsx(p,{message:d.premium})]})})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsx("label",{className:"sign__label",children:"Item type:"}),e.jsxs("ul",{className:"sign__radio",children:[e.jsxs("li",{children:[e.jsx("input",{id:"type1",type:"radio",name:"type","data-bs-toggle":"collapse","data-bs-target":".multi-collapse",value:"single",checked:a.content_type==="single",onChange:s=>g("content_type",s.target.value)}),e.jsx("label",{htmlFor:"type1",children:"Movie"})]}),e.jsxs("li",{children:[e.jsx("input",{id:"type2",type:"radio",name:"type","data-bs-toggle":"collapse","data-bs-target":".multi-collapse",value:"series",checked:a.content_type==="series",onChange:s=>g("content_type",s.target.value)}),e.jsx("label",{htmlFor:"type2",children:"TV Series"})]})]}),e.jsx(p,{message:d.content_type})]})}),e.jsx("div",{className:"col-12",children:e.jsx("div",{className:`collapse ${a.content_type==="single"?"show":""} multi-collapse`,children:e.jsxs("div",{className:"sign__video",children:[e.jsx("label",{htmlFor:"sign__video-upload",children:"Upload video"}),e.jsx("input",{id:"sign__video-upload",name:"video",className:"sign__gallery-upload",type:"file",accept:"video/mp4,video/x-m4v,video/*",onChange:y("video"),required:a.content_type==="single"}),e.jsx(p,{message:d.video})]})})}),a.content_type==="series"&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"collapse show multi-collapse",children:[c.map((s,i)=>e.jsxs("div",{className:"sign__season mb-4",children:[e.jsx("div",{className:"sign__season-head",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-12",children:[e.jsxs("span",{className:"sign__episode-title",children:["Season #",i+1]}),e.jsx("button",{type:"button",className:"sign__delete",onClick:()=>k(s.id),children:e.jsx("i",{className:"ti ti-x"})})]}),e.jsx("div",{className:"col-12 col-sm-6 col-md-5 col-xl-6",children:e.jsx("div",{className:"sign__group",children:e.jsx("input",{type:"text",className:"sign__input",placeholder:"Season title",value:s.title,onChange:t=>L(s.id,"title",t.target.value),required:!0})})}),e.jsx("div",{className:"col-12 col-md-6",children:e.jsx("div",{className:"sign__group",children:e.jsxs("div",{className:"sign__gallery2",children:[e.jsx("label",{htmlFor:"sign__gallery-upload",children:"Season Poster"}),e.jsx("input",{type:"file",className:"sign__gallery-upload",accept:".png, .jpg, .jpeg",onChange:t=>$(s.id,t),required:!0})]})})})]})}),s.episodes.map((t,l)=>e.jsx("div",{className:"sign__episode mt-3",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-12",children:[e.jsxs("span",{className:"sign__episode-title",children:["Episode #",l+1]}),s.episodes.length>1&&e.jsx("button",{type:"button",className:"sign__delete",onClick:()=>T(s.id,t.id),children:e.jsx("i",{className:"ti ti-x"})})]}),e.jsx("div",{className:"col-12 col-md-8",children:e.jsxs("div",{className:"sign__video",children:[e.jsxs("label",{htmlFor:`episode-video-${s.id}-${t.id}`,children:["Upload episode ",l+1]}),e.jsx("input",{id:`episode-video-${s.id}-${t.id}`,type:"file",accept:"video/mp4,video/x-m4v,video/*",onChange:r=>D(s.id,t.id,r),required:!0})]})}),e.jsx("div",{className:"col-12 col-md-4",children:e.jsxs("div",{className:"sign__group",children:[e.jsxs("select",{className:"form-select",value:t.is_premium?"1":"0",onChange:r=>b(s.id,t.id,r.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Premium"}),e.jsx("option",{value:"0",children:"Free"})]}),e.jsx(p,{message:d[`seasons.${i}.episodes.${l}.is_premium`]})]})}),e.jsx("div",{className:"col-12"})]})},t.id)),e.jsx("div",{className:"col-12 col-sm-4 col-md-3 col-xl-2 mt-2",children:e.jsx("button",{type:"button",className:"sign__btn sign__btn--add",onClick:()=>P(s.id),children:e.jsx("span",{children:"add episode"})})})]},s.id)),e.jsx("div",{className:"col-12 col-sm-4 col-md-3 col-xl-2 mt-3",children:e.jsx("button",{type:"button",className:"sign__btn sign__btn--add",onClick:R,children:e.jsx("span",{children:"add season"})})})]})}),e.jsx("div",{className:"col-12 mt-4",children:e.jsx("button",{type:"submit",className:"sign__btn sign__btn--small",disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"animate-spin mr-2"}),"Processing..."]}):e.jsx("span",{children:"Publish"})})})]})})})})]})};export{ee as default};
