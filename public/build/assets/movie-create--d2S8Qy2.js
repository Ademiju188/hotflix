import{r as d,m as P,j as e,L as D}from"./app-C2weOUhd.js";import{I as c}from"./input-error-6B614YZa.js";import{I as j}from"./input-field-BgY6ZdIY.js";import{A as L}from"./app-layout-moFQN0ro.js";import{S as M}from"./slimselect-BwEOPyc-.js";import{L as R}from"./loader-circle-D561zkUL.js";import"./clsx-B-dksMZM.js";const k=({categories:_})=>{const u=d.useRef(null),[T,f]=d.useState([]),[g,N]=d.useState(null),[h,m]=d.useState(!1),[x,b]=d.useState({}),{data:r,setData:t,post:S,errors:n,reset:w,progress:p}=P({title:"",description:"",featured:!0,premium:!1,episode_no:1,banner:null,categories:[],episodes:Array(1).fill(null).map(()=>({id:Date.now().toString()+Math.random().toString(36).substr(2,9),video:null,is_premium:!1}))});d.useEffect(()=>{const i=r.episode_no,s=r.episodes.length;if(i>s){const a=i-s,l=Array(a).fill(null).map(()=>({id:Date.now().toString()+Math.random().toString(36).substr(2,9),video:null,is_premium:!1}));t("episodes",[...r.episodes,...l])}else i<s&&t("episodes",r.episodes.slice(0,i))},[r.episode_no]);const y=i=>s=>{if(s.target.files&&s.target.files[0]){const a=s.target.files[0];t(i,a);{const l=new FileReader;l.onload=o=>{var v;(v=o.target)!=null&&v.result&&N(o.target.result)},l.readAsDataURL(a)}}},C=(i,s)=>{if(s.target.files&&s.target.files[0]){const a=s.target.files[0];if(!["video/mp4","video/x-m4v","video/quicktime"].includes(a.type)){alert("Only MP4, M4V, and QuickTime videos are allowed"),s.target.value="";return}t("episodes",r.episodes.map(o=>o.id===i?{...o,video:a}:o));const l=URL.createObjectURL(a);b(o=>({...o,[i]:l}))}},E=(i,s)=>{t("episodes",r.episodes.map(a=>a.id===i?{...a,is_premium:s}:a))},F=async i=>{i.preventDefault(),m(!0);try{const s=new FormData;s.append("title",r.title),s.append("description",r.description),s.append("featured",r.featured?"1":"0"),s.append("premium",r.premium?"1":"0"),s.append("episode_no",r.episode_no.toString()),r.banner&&s.append("banner",r.banner),r.categories.forEach(a=>s.append("categories[]",a.toString())),r.episodes.forEach((a,l)=>{a.video&&(s.append(`episodes[${l}][video]`,a.video),s.append(`episodes[${l}][is_premium]`,a.is_premium?"1":"0"))}),await S(route("system.movie.store"),{formData:s,onSuccess:()=>{m(!1),w()},onError:a=>{m(!1),console.error("Submission errors:",a)}})}catch(s){m(!1),console.error("Submission error:",s)}};return d.useEffect(()=>{if(u.current){const i=new M({select:u.current,settings:{showSearch:!0,placeholderText:"Select Categories",closeOnSelect:!1},events:{afterChange:s=>{const a=s.map(l=>parseInt(l.value));f(a),t("categories",a)}}});return()=>{i.destroy()}}},[]),e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Mini Series"}),e.jsx(L,{title:"Mini Series",mainTitle:!0,children:e.jsx("div",{className:"col-12",children:e.jsx("form",{onSubmit:F,className:"sign__form sign__form--add",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 col-xl-6",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsx(j,{name:"title",value:r.title,onChange:(i,s)=>t(i,s),placeholder:"Title",error:n.title,required:!0}),e.jsx(c,{message:n.title})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsx("textarea",{className:`sign__textarea ${n.description?"is-invalid":""}`,placeholder:"Description",onChange:i=>t("description",i.target.value),value:r.description}),e.jsx(c,{message:n.description})]})}),g&&e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"mt-2 mb-3",children:e.jsx("img",{src:g,alt:"Banner preview",className:"img-thumbnail",style:{maxWidth:"200px",maxHeight:"200px"}})})})]})}),e.jsx("div",{className:"col-12 col-xl-6",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsxs("div",{className:"sign__gallery",children:[e.jsx("label",{htmlFor:"sign__gallery-upload",children:"Upload Poster"}),e.jsx("input",{id:"sign__gallery-upload",name:"banner",className:"sign__gallery-upload",type:"file",accept:".png, .jpg, .jpeg",onChange:y("banner"),required:!0})]}),e.jsx(c,{message:n.banner})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsx("label",{className:"sign__label",children:"No. of Episode:"}),e.jsx(j,{type:"number",name:"episode_no",onChange:(i,s)=>{const a=parseInt(s);isNaN(a)||t(i,Math.max(1,a))},placeholder:"No. of Episode",error:n.episode_no}),e.jsx(c,{message:n.episode_no})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__group",children:[e.jsx("select",{className:"sign__selectjs",id:"sign__genre",ref:u,multiple:!0,children:_.data.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))}),e.jsx(c,{message:n.categories})]})})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"sign__episodes mt-4",children:[e.jsx("h4",{className:"sign__title",children:"Episodes"}),r.episodes.map((i,s)=>e.jsx("div",{className:"sign__episode mt-3",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12",children:e.jsxs("span",{className:"sign__episode-title",children:["Episode #",s+1]})}),e.jsx("div",{className:"col-12 col-md-8",children:e.jsxs("div",{className:"sign__video",children:[e.jsxs("label",{htmlFor:`episode-video-${i.id}`,children:["Upload episode ",s+1]}),e.jsx("input",{id:`episode-video-${i.id}`,type:"file",accept:"video/mp4,video/x-m4v,video/*",onChange:a=>C(i.id,a),required:!0})]})}),e.jsx("div",{className:"col-12 col-md-4",children:e.jsxs("div",{className:"sign__group",children:[e.jsxs("select",{className:"form-select",value:i.is_premium?"1":"0",onChange:a=>E(i.id,a.target.value==="1"),children:[e.jsx("option",{value:"0",children:"Free"}),e.jsx("option",{value:"1",children:"Premium"})]}),e.jsx(c,{message:n[`episodes.${s}.is_premium`]})]})}),x[i.id]&&e.jsx("video",{src:x[i.id],controls:!0,style:{maxWidth:"300px"}})]})},i.id))]})}),e.jsxs("div",{className:"col-12 mt-4",children:[e.jsx("button",{type:"submit",className:"sign__btn sign__btn--small",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"animate-spin mr-2"}),"Processing..."]}):e.jsx("span",{children:"Publish"})}),p&&e.jsxs("div",{className:"mt-4 text-white",children:[e.jsxs("p",{children:["Uploading: ",p.percentage,"%"]}),e.jsx("div",{className:"progress",children:e.jsxs("div",{className:"progress-bar bg-warning",role:"progressbar",style:{width:`${p.percentage}%`},"aria-valuemin":"0","aria-valuemax":"100",children:[p.percentage,"%"]})})]})]})]})})})})]})};export{k as default};
